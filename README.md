# ПОЛУЧЕНИЕ ИНФОРМАЦИИ О ЮРИДИЧЕСКИХ ЛИЦАХ ПО ИНН (API reputation.ru)

Программа позволяет быстро получить основные данные о российских компаниях (юридических лицах) по их ИНН, используя API сервиса [Репутация](https://reputation.ru/). 

На вход программа принимает перечень ИНН (через запятую в командной строке или ссылкой на диапазон в файле Excel) и выводит следующие данные:

1) Краткое имя
2) Полное имя
3) Адрес
4) Руководитель
5) Сфера деятельности (основная по ОГРН)
6) Дата регистрации
7) Вебсайт (основной)
8) Тел. (список)
9) Email (список)

Программа позволяет сохранить результаты в CSV файл и/или в исходный Excel файл (рядом с соответствующими ИНН).

## Установка

Всё тривиально: клонируем репозиторий, создаём виртуальную среду Python, устанавливаем зависимости.

```
git clone git@github.com:S0mbre/reputation_companies.git .
```

### UNIX
```
python3 -m venv my_venv /path/to/venvs
. /path/to/venvs/bin/activate
cd ./reputation_companies
pip install -r ./requirements.txt
```

### WINDOWS

```
python -m venv my_venv "C:\path\to\venvs"
"C:\path\to\venvs\Scripts\activate.bat"
cd reputation_companies
python -m pip install -r requirements.txt
```

## Получение API-ключа сервиса Репутация

Чтобы програма работала, в ее каталоге должен находиться файл `.env` с [API-ключом сервиса Репутация](https://reputation.ru/account/api). Для этого необходимо зарегистрироваться на сервисе и перейти в __Личный кабинет > API__ и скопировать оттуда API-ключ и затем создать `.env` файл в каталоге программы со следующим содержанием:

```
API_KEY=<ВАШ API-ключ>
```

## Запуск

Запускаем программу `findcomp.py` из активированной виртуальной среды (см. выше). 

### Основные параметры

На вход программа ожидает список ИНН:

- либо в параметре командной строки `-i` (`--inn`) через запятую, например:

```
python findcomp.py -i "0123456789, 9876543210, 1233215677650"
```

- либо в виде ссылки на диапазон (столбец) в файле Excel в параметре `-x` (`--xl`), например:

```
python findcomp.py -x "source/excel.xlsx" -s "Лист1" -r "a1:a100"
```

Параметры:
- `-x` (`--xl`): путь к исходному файлу Excel
- `-s` (`--sheet`): номер или название листа Excel (можно не указывать, тогда это будет первый лист в книге)
- `-r` (`--rginn`): диапазон с перечнем ИНН в виде "A1:A100" (если охватывает несколько столбцов, то будет использован только крайний справа!)

### Дополнительные параметры

Некоторые данные (такие как телефонные номера и адреса электронной почты) программа выводит списком. Для этих полей можно задать максимальное количество выводимых элементов параметром `-m` (`--max`):

```
python findcomp.py -i "0123456789, 9876543210, 1233215677650" -m 2
```

В этом примере для всех списочных полей будет выводиться не более 2 элементов. Если парамер `-m` не указывать, то данные будут содержать все доступные элементы.

### Параметры вывода результатов

Для сохранения результатов в формате CSV (текст, разделенный запятыми) используется параметр `-o` (`--out`), который задает путь до файла сохранения, например:

```
python findcomp.py -i "0123456789, 9876543210, 1233215677650" -m 2 -o "path/to/file.csv"
```

Также если источником исходных ИНН является файл Excel, есть возможность записать результаты в табличном виде непосредственно в этот же лист, напротив каждого ИНН. Это поведение задается параметром `--offset` (сокращенного варианта нет), который определяет смещение по столбцам для записи результатов относительно столбца с исходными ИНН.

```
python findcomp.py -x "source/excel.xlsx" -r "A1:C100" --offset 1
```

В примере выше результаты будут записаны для всех строк начиная с 4-го (`D`) столбца (т.к. для исходного столбца будет принят крайний правый в указанном диапазоне, т.е. столбец `C`).

Можно совмещать оба варианта вывода: Excel и CSV. Например, используя пример выше:

```
python findcomp.py -x "source/excel.xlsx" -r "A1:C100" --offset 1 -m 2 -o "path/to/file.csv"
```

Если не указан ни `-o` (`--out`), ни `--offset`, то результаты никуда не сохраняются!